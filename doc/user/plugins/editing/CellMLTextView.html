<!DOCTYPE html>
<html>
    <head>
        <title>
            CellMLTextView Plugin
        </title>

        <meta http-equiv="content-type" content="text/html; charset=utf-8"/>

        <link href="../../res/stylesheet.css" rel="stylesheet" type="text/css"/>

        <script src="../../../3rdparty/jQuery/jquery.js" type="text/javascript"></script>
        <script src="../../../res/common.js" type="text/javascript"></script>
        <script src="../../res/menu.js" type="text/javascript"></script>
        <script src="../../res/imagepopup.js" type="text/javascript"></script>

        <style>
            span.cmetaid {
                font-style: italic;
            }

            span.comment {
                color: rgb(127, 127, 127);
            }

            span.keyword {
                color: rgb(0, 0, 127);
            }
        </style>
    </head>
    <body ondragstart="return false;" ondrop="return false;">
        <script type="text/javascript">
            headerAndContentsMenu("CellMLTextView Plugin", "../../..");
        </script>

        <p>
            The CellMLTextView plugin can be used to edit <a href="http://www.cellml.org/">CellML</a> files using a text editor that supports the <a href="#CellML%20Text%20format">CellML text format</a>. If you open a file, it will look something like:
        </p>

        <p class="center">
            <img class="link" src="res/pics/CellMLTextViewScreenshot01.png" width=360 height=270 imagepopup>
        </p>

        <p>
            Apart from using a specific format, the view has the same features as the <a href="RawCellMLView.html">RawCellML</a> view.
        </p>

        <div class="section">
            Compatibility with COR
        </div>

        <p>
            People familiar with <a href="http://cor.physiol.ox.ac.uk/">COR</a> will find that the <a href="#CellML%20Text%20format">CellML text format</a> is backward compatible with the COR format and that it has been extended to support:
        </p>

        <ul>
            <li><a href="#Comments">Comments</a>;</li>
            <li>The <code>import</code> element (i.e. support for CellML 1.1);</li>
            <li>The <code>cmeta:id</code> attribute on all CellML elements (i.e. support for CellML annotation);</li>
            <li>The <code>degree</code> qualifier for the <code>diff</code> element (i.e. not limited to first derivatives);</li>
            <li>The <code>notanumber</code> and <code>infinity</code> constants; and</li>
            <li>An unlimited number of group types (in <a href="http://cor.physiol.ox.ac.uk/">COR</a>, a group can only specify one <code>encapsulation</code> and/or one <code>containment</code> type).</li>
        </ul>

        <p>
            The <a href="http://cor.physiol.ox.ac.uk/">COR</a> format has some limitations that are also present in the <a href="#CellML%20Text%20format">CellML text format</a>:
        </p>

        <ul>
            <li>The <code>reaction</code> element is not supported (its use is not only discouraged, but it is also to be removed from the forthcoming CellML 1.2 specifications);</li>
            <li>A <code>piecewise</code> statement can only be used as part of a top-level <code>eq</code> statement, and nested <code>piecewise</code> statements are not allowed (the latter is not a limitation per se since an equation can always be rewritten without the need for nested <code>piecewise</code> statements; more importantly, it is easier to read and maintain an equation that uses only one top-level <code>piecewise</code> statement); and</li>
            <li>A <code>component</code> element may contain a set of <code>math</code> elements, but its rendering is such that when serialised back, only one <code>math</code> element will remain, with all the equations in that one and unique <code>math</code> element.</li>
        </ul>

        <span class="anchor" id="Comments"></span>

        <div class="section">
            Comments
        </div>

        <p>
            You can (un)comment a piece of code by pressing <code>Ctrl</code>+<code>/</code>. If no text is selected or if the selected text consists of one or several full lines, then the comment will be rendered as <code>// XXX</code>, e.g.
        </p>

        <pre><span class="keyword">def model</span> my_model <span class="keyword">as</span>
    <span class="comment">// A single line comment</span>
    ...
<span class="keyword">endef</span>;</pre>

        <p>
            Alternatively, if some text is selected and it does not consist of one or several full lines, then the comment will be rendered as <code>/* XXX */</code>, e.g.
        </p>

        <pre><span class="keyword">def model</span> my_<span class="comment">/*super_duper_*/</span>model <span class="keyword">as</span>
    ...
<span class="keyword">endef</span>;</pre>

        <p>
            Note that <code>/* XXX */</code> comments are only for convenience and are not serialised back to CellML. Indeed, such comments can be inserted anywhere, including within an equation, e.g.:
        </p>

        <pre><span class="keyword">ode</span>(V, time) = -(i_Na+i_K+i_Leak<span class="comment">/*+i_Stim*/</span>)/Cm;</pre>

        <p>
            It is therefore difficult, if not impossible, to determine where such comments should be included when serialised back.
        </p>

        <p>
             <code>// XXX</code> comments can also be inserted anywhere, but unlike <code>/* XXX */</code> comments they are serialised back. However, the rendering of certain elements using the <a href="#CellML%20Text%20format">CellML text format</a> is such that when serialised back, <code>// XXX</code> comments may be included in the parent element of those elements, and either before or after those elements, depending on the case.
        </p>

        <span class="anchor" id="CellML Text format"></span>

        <div class="section">
            CellML Text format
        </div>

        <p>
            The CellML Text format offers, for the large part, a one-to-one mapping to the CellML format with the view of making it easier to create and edit CellML files.
        </p>

        <div class="subSection">
            Model structure
        </div>

        <p>
            To <code>def</code>ine a <code>model</code> with the name <code>my_model</code>, we use:
        </p>

        <pre><span class="keyword">def model</span> my_model <span class="keyword">as</span>
    ...
<span class="keyword">endef</span>;</pre>

        <p class="note">
            the model definition itself is to sit between <code>as</code> and <code>enddef;</code>.
        </p>

        <div class="subSection">
            Imports
        </div>

        <p>
            To be done...
        </p>

        <div class="subSection">
            Units
        </div>

        <p>
            To be done...
        </p>

        <div class="subSection">
            Mathematics
        </div>

        <p>
            To be done...
        </p>

        <div class="subSection">
            Grouping
        </div>

        <p>
            To be done...
        </p>

        <div class="subSection">
            Metadata
        </div>

        <p>
            The CellML Text format does not support the editing of CellML annotations. However, <code>cmeta:id</code>'s are used to make the link between CellML elements and CellML annotations. So, we need the CellML Text format to support the use of <code>cmeta:id</code>'s and this is done by enclosing a <code>cmeta:id</code> value (e.g. <code>my_cmeta_id</code>) within curly brackets:
        </p>

        <pre><span class="cmetaid">{my_cmeta_id}</span></pre>

        <p>
            which can then be used to annotate various CellML elements:
        </p>

        <pre><span class="keyword">def model</span><span class="cmetaid">{my_model_cmeta_id}</span> my_model <span class="keyword">as</span>
    ...
<span class="keyword">endef</span>;</pre>

        <script type="text/javascript">
            copyright("../../..");
        </script>
    </body>
</html>
