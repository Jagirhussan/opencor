<!DOCTYPE html>
<html>
    <head>
        <title>
            CellMLTextView Plugin
        </title>

        <meta http-equiv="content-type" content="text/html; charset=utf-8"/>

        <link href="../../../3rdparty/KaTeX/katex.min.css" rel="stylesheet" type="text/css"/>
        <link href="../../res/stylesheet.css" rel="stylesheet" type="text/css"/>

        <script src="../../../3rdparty/jQuery/jquery.js" type="text/javascript"></script>
        <script src="../../../3rdparty/KaTeX/katex.min.js" type="text/javascript"></script>
        <script src="../../../res/common.js" type="text/javascript"></script>
        <script src="../../res/menu.js" type="text/javascript"></script>
        <script src="../../res/imagepopup.js" type="text/javascript"></script>

        <style>
            span.cellmlkeyword {
                color: rgb(127, 0, 127);
            }

            span.cmetaid,
            span.parameterblock {
                font-style: italic;
            }

            span.comment {
                color: rgb(127, 127, 127);
            }

            span.keyword {
                color: rgb(0, 0, 127);
            }

            span.number {
                color: rgb(0, 127, 127);
            }

            span.string {
                color: rgb(0, 127, 0);
            }

            table {
                margin: 1em 0em;
            }

            table > tbody > tr > td {
                padding: 0em 1em;
                text-align: center;
            }
        </style>
    </head>
    <body ondragstart="return false;" ondrop="return false;">
        <script type="text/javascript">
            headerAndContentsMenu("CellMLTextView Plugin", "../../..");
        </script>

        <p>
            The CellMLTextView plugin can be used to edit <a href="http://www.cellml.org/">CellML</a> files using a text editor that supports the <a href="#CellML%20Text%20format">CellML text format</a>. If you open a file, it will look something like:
        </p>

        <p class="center">
            <img class="link" src="res/pics/CellMLTextViewScreenshot01.png" width=360 height=270 imagepopup>
        </p>

        <p>
            Apart from using a specific format, the view has the same features as the <a href="RawCellMLView.html">RawCellML</a> view.
        </p>

        <div class="section">
            Compatibility with COR
        </div>

        <p>
            People familiar with <a href="http://cor.physiol.ox.ac.uk/">COR</a> will find that the <a href="#CellML%20Text%20format">CellML text format</a> is backward compatible with the COR format and that it has been extended to support:
        </p>

        <ul>
            <li><a href="#Comments">Comments</a>;</li>
            <li>The <code>import</code> element (i.e. support for CellML 1.1);</li>
            <li>The <code>cmeta:id</code> attribute on all CellML elements (i.e. support for CellML annotation);</li>
            <li>The <code>degree</code> qualifier for the <code>diff</code> element (i.e. not limited to first derivatives);</li>
            <li>The <code>notanumber</code> and <code>infinity</code> constants; and</li>
            <li>An unlimited number of group types (in <a href="http://cor.physiol.ox.ac.uk/">COR</a>, a group can only specify one <code>encapsulation</code> and/or one <code>containment</code> type).</li>
        </ul>

        <p>
            The <a href="http://cor.physiol.ox.ac.uk/">COR</a> format has some limitations that are also present in the <a href="#CellML%20Text%20format">CellML text format</a>:
        </p>

        <ul>
            <li>The <code>reaction</code> element is not supported (its use is not only discouraged, but it is also to be removed from the forthcoming CellML 1.2 specifications);</li>
            <li>A <code>piecewise</code> statement can only be used as part of a top-level <code>eq</code> statement, and nested <code>piecewise</code> statements are not allowed (the latter is not a limitation per se since an equation can always be rewritten without the need for nested <code>piecewise</code> statements; more importantly, it is easier to read and maintain an equation that uses only one top-level <code>piecewise</code> statement); and</li>
            <li>A <code>component</code> element may contain a set of <code>math</code> elements, but its rendering is such that when serialised back, only one <code>math</code> element will remain, with all the equations in that one and unique <code>math</code> element.</li>
        </ul>

        <span class="anchor" id="Comments"></span>

        <div class="section">
            Comments
        </div>

        <p>
            You can (un)comment a piece of code by pressing <code>Ctrl</code>+<code>/</code>. If no text is selected or if the selected text consists of one or several full lines, then the comment will be rendered as <code>// XXX</code>, e.g.
        </p>

        <pre><span class="keyword">def model</span> my_model <span class="keyword">as</span>
    <span class="comment">// A single line comment</span>
    ...
<span class="keyword">endef</span>;</pre>

        <p>
            Alternatively, if some text is selected and it does not consist of one or several full lines, then the comment will be rendered as <code>/* XXX */</code>, e.g.
        </p>

        <pre><span class="keyword">def model</span> my_<span class="comment">/*super_duper_*/</span>model <span class="keyword">as</span>
    ...
<span class="keyword">endef</span>;</pre>

        <p>
            Note that <code>/* XXX */</code> comments are only for convenience and are not serialised back to CellML. Indeed, such comments can be inserted anywhere, including within an equation, e.g.:
        </p>

        <pre><span class="keyword">ode</span>(V, time) = -(i_Na+i_K+i_Leak<span class="comment">/*+i_Stim*/</span>)/Cm;</pre>

        <p>
            It is therefore difficult, if not impossible, to determine where such comments should be included when serialised back.
        </p>

        <p>
             <code>// XXX</code> comments can also be inserted anywhere, but unlike <code>/* XXX */</code> comments they are serialised back. However, the rendering of certain elements using the <a href="#CellML%20Text%20format">CellML text format</a> is such that when serialised back, <code>// XXX</code> comments may be included in the parent element of those elements, and either before or after those elements, depending on the case.
        </p>

        <span class="anchor" id="CellML Text format"></span>

        <div class="section">
            CellML Text format
        </div>

        <p>
            The CellML Text format offers, for the large part, a one-to-one mapping to the CellML format with the view of making it easier to create and edit CellML files.
        </p>

        <div class="subSection">
            Model
        </div>

        <p>
            To <code>def</code>ine a <code>model</code> of name <code>my_model</code>, we use:
        </p>

        <pre><span class="keyword">def model</span> my_model <span class="keyword">as</span>
    ...
<span class="keyword">endef</span>;</pre>

        <p class="note">
            the model definition itself is to sit between <code>as</code> and <code>enddef;</code>.
        </p>

        <div class="subSection">
            Imports
        </div>

        <p>
            To <code>def</code>ine an <code>import</code> for units and components defined in a CellML file, which <a href="http://en.wikipedia.org/wiki/Uniform_resource_identifier">URI</a> is <code>my_imported_model_uri</code>, we use:
        </p>

        <pre><span class="keyword">def import using</span> <span class="string">"my_imported_model_uri"</span> <span class="keyword">for</span>
    ...
<span class="keyword">endef</span>;</pre>

        <p>
            To import a <code>unit</code> originally named <code>my_reference_unit</code> and renamed <code>my_imported_unit</code> in our model, we use:
        </p>

        <pre><span class="keyword">unit</span> my_imported_unit <span class="keyword">using unit</span> my_reference_unit;</pre>

        <p>
            Similarly, to import a <code>component</code> originally named <code>my_reference_component</code> and renamed <code>my_imported_component</code> in our model, we use:
        </p>

        <pre><span class="keyword">comp</span> my_imported_component <span class="keyword">using comp</span> my_reference_component;</pre>

        <p>
            Putting everything together, we get:
        </p>

        <pre><span class="keyword">def import</span> <span class="keyword">using</span> <span class="string">"my_imported_model_uri"</span> <span class="keyword">for</span>
    <span class="keyword">unit</span> my_imported_unit <span class="keyword">using unit</span> my_reference_unit;
    <span class="keyword">comp</span> my_imported_component <span class="keyword">using comp</span> my_reference_component;
<span class="keyword">endef</span>;</pre>

        <div class="subSection">
            Units
        </div>

        <p>
            To <code>def</code>ine a <code>base unit</code> of name <code>my_base_unit</code>, we use:
        </p>

        <pre><span class="keyword">def unit</span> my_base_unit <span class="keyword">as</span> <span class="cellmlkeyword">base</span> <span class="keyword">unit</span>;</pre>

        <p>
            To <code>def</code>ine a <code>unit</code>, of name <code>my_unit</code>, based on some other units, we use:
        </p>

        <pre><span class="keyword">def unit</span> my_unit <span class="keyword">as</span>
    <span class="keyword">unit</span> other_unit <span class="parameterblock">{...}</span>;
    <span class="keyword">unit</span> <span class="cellmlkeyword">second</span> <span class="parameterblock">{...}</span>;
    <span class="keyword">unit</span> <span class="cellmlkeyword">litre</span> <span class="parameterblock">{...}</span>;
    ...
<span class="keyword">enddef</span>;</pre>

        <p>
            <code>other_unit</code> refers to a user-defined unit while <code>second</code> is an <a href="http://en.wikipedia.org/wiki/International_System_of_Units">SI</a> base unit and <code>litre</code> an <a href="http://en.wikipedia.org/wiki/International_System_of_Units">SI</a> derived unit. The following <a href="http://en.wikipedia.org/wiki/International_System_of_Units">SI</a> base (in bold) and derived units, as well as convenience units (in italics), can be used:
        </p>

        <table>
            <tr>
                <td><strong>ampere</strong></td>
                <td>becquerel</td>
                <td><strong>candela</strong></td>
                <td>celsius</td>
                <td>coulomb</td>
                <td><em>dimensionless</em></td>
            </tr>
            <tr>
                <td>farad</td>
                <td><em>gram</em></td>
                <td>gray</td>
                <td>henry</td>
                <td>hertz</td>
                <td>joule</td>
            </tr>
            <tr>
                <td>katal</td>
                <td><strong>kelvin</strong></td>
                <td><strong>kilogram</strong></td>
                <td><em>liter</em></td>
                <td><em>litre</em></td>
                <td>lumen</td>
            </tr>
            <tr>
                <td>lux</td>
                <td><strong>meter</strong></td>
                <td><strong>metre</strong></td>
                <td><strong>mole</strong></td>
                <td>newton</td>
                <td>ohm</td>
            </tr>
            <tr>
                <td>pascal</td>
                <td>radian</td>
                <td><strong>second</strong></td>
                <td>siemens</td>
                <td>sievert</td>
                <td>steradian</td>
            </tr>
            <tr>
                <td>tesla</td>
                <td>volt</td>
                <td>watt</td>
                <td>weber</td>
                <td/>
                <td/>
            </tr>
        </table>

        <p>
            <code>pref</code>ix, <code>expo</code>nent, <code>mult</code>iplier and <code>off</code>set values of <span id="katex_p"></span>, <span id="katex_e"></span>, <span id="katex_m"></span> and <span id="katex_o"></span> can be used on a unit <span id="katex_u"></span> to define a new unit equivalent to <span id="katex_new_unit"></span>. For example, to define <code>my_unit</code> as being equivalent to <span id="katex_my_unit"></span>, we would use:
        </p>

        <script type="text/javascript">
            katex.render("p", katex_p);
            katex.render("e", katex_e);
            katex.render("m", katex_m);
            katex.render("o", katex_o);
            katex.render("u", katex_u);
            katex.render("m \\cdot (p \\cdot u)^e+o", katex_new_unit);
            katex.render("3 \\cdot (milli \\cdot other\\_unit)^{-1}+7", katex_my_unit);
        </script>

        <pre><span class="keyword">def unit</span> my_unit <span class="keyword">as</span>
    <span class="keyword">unit</span> other_unit <span class="parameterblock">{<span class="keyword">pref</span>: <span class="cellmlkeyword">milli</span>, <span class="keyword">expo</span>: -<span class="number">1</span>, <span class="keyword">mult</span>: <span class="number">3</span>, <span class="keyword">off</span>: <span class="number">7</span>}</span>;
<span class="keyword">enddef</span>;</pre>

        <div class="subSection">
            Mathematics
        </div>

        <p>
            To be done...
        </p>

        <div class="subSection">
            Grouping
        </div>

        <p>
            To be done...
        </p>

        <div class="subSection">
            Metadata
        </div>

        <p>
            The CellML Text format does not support the editing of CellML annotations. However, <code>cmeta:id</code>'s are used to make the link between CellML elements and CellML annotations. So, we need the CellML Text format to support the use of <code>cmeta:id</code>'s and this is done by enclosing a <code>cmeta:id</code> value (e.g. <code>my_cmeta_id</code>) within curly brackets:
        </p>

        <pre><span class="cmetaid">{my_cmeta_id}</span></pre>

        <p>
            which can then be used to annotate various CellML elements:
        </p>

        <pre><span class="keyword">def model</span><span class="cmetaid">{my_model_cmeta_id}</span> my_model <span class="keyword">as</span>
    <span class="keyword">def import</span><span class="cmetaid">{my_import_cmeta_id}</span> <span class="keyword">using</span> <span class="string">"my_imported_model_uri"</span> <span class="keyword">for</span>
        <span class="keyword">unit</span><span class="cmetaid">{my_imported_unit_cmeta_id}</span> my_imported_unit <span class="keyword">using unit</span> my_reference_unit;
        <span class="keyword">comp</span><span class="cmetaid">{my_imported_component_cmeta_id}</span> my_imported_component <span class="keyword">using comp</span> my_reference_component;
    <span class="keyword">endef</span>;
<span class="keyword">endef</span>;</pre>

        <script type="text/javascript">
            copyright("../../..");
        </script>
    </body>
</html>
